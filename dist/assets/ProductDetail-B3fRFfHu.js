import{c as q,d as D,m as H,k as j,n as Q,r,j as a,e as K,p as V,b as B,L as G,l as J}from"./index-0d2ZcZCT.js";import{_ as m,$ as A,a as U,b as _,C as W,c as X,d as Y,e as Z,f as ee,g as ae,h as te}from"./card-LvmN36X9.js";import{$ as oe,a as v,b as se,c as re,d as le,e as ce,f as ne,g as de,h as w,i as ie,j as fe}from"./index-CgkWmmfS.js";import{c as p}from"./utils-CHtjtCvc.js";import{I as N,v as me,a as pe,b as ue}from"./validation-CMFxILfB.js";import{u as xe,E as be}from"./Error-3xo88CJ_.js";const $e=({name:t,tel:o,email:s,product:e,user:l})=>{if(!window.IMP)return;const{IMP:d}=window;d==null||d.init("imp48760701");const f={pg:"html5_inicis",pay_method:"card",merchant_uid:`mid_${new Date().getTime()}`,amount:1,name:e==null?void 0:e.productName,buyer_name:t,buyer_tel:o,buyer_email:s};d.request_pay(f,async x=>{const{success:$,error_msg:c,imp_uid:n}=x;if($){console.log("결제 성공",n);try{const b={sellerId:e==null?void 0:e.userEmail,buyerId:l.email,productId:e==null?void 0:e.productId,status:"주문 완료",updatedAt:new Date,createdAt:new Date},g=q(D,"orders"),y=await H(g,b);if(console.log("Order created with ID: ",y.id),e!=null&&e.productId){const h=j(D,"products",e.productId);await Q(h,{isSell:!0}),console.log("Product updated to sold: ",e.productId)}alert("결제 성공: 주문이 완료되었습니다.")}catch(b){console.error("Order creation failed:",b)}alert("결제 성공")}else console.error("결제 실패:",c),alert(`결제 실패: ${c}`)})},ge="AlertDialog",[ye,Be]=oe(ge,[v]),u=v(),he=t=>{const{__scopeAlertDialog:o,...s}=t,e=u(o);return r.createElement(ie,m({},e,s,{modal:!0}))},Ne=t=>{const{__scopeAlertDialog:o,...s}=t,e=u(o);return r.createElement(fe,m({},e,s))},De=r.forwardRef((t,o)=>{const{__scopeAlertDialog:s,...e}=t,l=u(s);return r.createElement(se,m({},l,e,{ref:o}))}),C="AlertDialogContent",[je,Ae]=ye(C),_e=r.forwardRef((t,o)=>{const{__scopeAlertDialog:s,children:e,...l}=t,d=u(s),f=r.useRef(null),x=A(o,f),$=r.useRef(null);return r.createElement(re,{contentName:C,titleName:ve,docsSlug:"alert-dialog"},r.createElement(je,{scope:s,cancelRef:$},r.createElement(le,m({role:"alertdialog"},d,l,{ref:x,onOpenAutoFocus:ce(l.onOpenAutoFocus,c=>{var n;c.preventDefault(),(n=$.current)===null||n===void 0||n.focus({preventScroll:!0})}),onPointerDownOutside:c=>c.preventDefault(),onInteractOutside:c=>c.preventDefault()}),r.createElement(U,null,e),!1)))}),ve="AlertDialogTitle",we=r.forwardRef((t,o)=>{const{__scopeAlertDialog:s,...e}=t,l=u(s);return r.createElement(ne,m({},l,e,{ref:o}))}),Ce=r.forwardRef((t,o)=>{const{__scopeAlertDialog:s,...e}=t,l=u(s);return r.createElement(de,m({},l,e,{ref:o}))}),Ee=r.forwardRef((t,o)=>{const{__scopeAlertDialog:s,...e}=t,l=u(s);return r.createElement(w,m({},l,e,{ref:o}))}),Re="AlertDialogCancel",Pe=r.forwardRef((t,o)=>{const{__scopeAlertDialog:s,...e}=t,{cancelRef:l}=Ae(Re,s),d=u(s),f=A(o,l);return r.createElement(w,m({},d,e,{ref:f}))}),Ie=he,Se=Ne,E=De,R=_e,P=Ee,I=Pe,S=we,O=Ce,Oe=Ie,Te=Se,T=r.forwardRef(({className:t,...o},s)=>a.jsx(E,{className:p("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...o,ref:s}));T.displayName=E.displayName;const M=r.forwardRef(({className:t,...o},s)=>a.jsxs(Te,{children:[a.jsx(T,{}),a.jsx(R,{ref:s,className:p("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...o})]}));M.displayName=R.displayName;const F=({className:t,...o})=>a.jsx("div",{className:p("flex flex-col space-y-2 text-center sm:text-left",t),...o});F.displayName="AlertDialogHeader";const L=({className:t,...o})=>a.jsx("div",{className:p("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...o});L.displayName="AlertDialogFooter";const k=r.forwardRef(({className:t,...o},s)=>a.jsx(S,{ref:s,className:p("text-lg font-semibold",t),...o}));k.displayName=S.displayName;const Me=r.forwardRef(({className:t,...o},s)=>a.jsx(O,{ref:s,className:p("text-sm text-muted-foreground",t),...o}));Me.displayName=O.displayName;const Fe=r.forwardRef(({className:t,...o},s)=>a.jsx(P,{ref:s,className:p(_(),t),...o}));Fe.displayName=P.displayName;const Le=r.forwardRef(({className:t,...o},s)=>a.jsx(I,{ref:s,className:p(_({variant:"outline"}),"mt-2 sm:mt-0",t),...o}));Le.displayName=I.displayName;const ke=async t=>{const o=j(D,"products",t),s=await J(o);if(s.exists())return{productId:s.id,...s.data()}},Ge=()=>{const{user:t}=K(),{productId:o}=V(),s=B(),{data:e,isLoading:l,error:d}=xe({queryKey:["product",o],queryFn:()=>ke(o),initialData:()=>{const i=s.getQueryData(["product",o]);return console.log("Initial data from cache:",i),i||void 0},staleTime:5e3}),[f,x]=r.useState(""),[$,c]=r.useState(!1),[n,b]=r.useState({name:"",tel:"",email:"",product:void 0,user:t});r.useEffect(()=>{e&&b(i=>({...i,product:e}))},[e,t]);const g=i=>{b({...n,[i.target.name]:i.target.value})},y=()=>{t.email?t.isSeller?alert("구매자 아이디 로그인이 필요합니다."):c(!0):alert("구매자 아이디 로그인이 필요합니다.")},h=()=>{c(!1),b({name:"",tel:"",email:"",user:t,product:e})},z=()=>{if(!me(n.name)){x("이름을 입력해주세요");return}if(!pe(n.tel)){x("휴대폰 번호를 입력해주세요");return}if(!ue(n.email)){x("email 형식에 맞춰 주세요");return}c(!1),$e(n)};return l?a.jsx(G,{}):d?a.jsx(be,{}):a.jsxs("div",{className:"flex w-full h-full pt-10",children:[a.jsx("div",{className:"flex-1 py-6 relative",children:a.jsxs(W,{className:"w-full max-w-xs mx-auto",children:[a.jsx(X,{children:e&&e.productImages.map(i=>a.jsx(Y,{children:a.jsx(Z,{children:a.jsx(ee,{className:"flex aspect-square items-center justify-center p-3",children:a.jsx("img",{src:i,alt:"Product",className:"object-cover"})})})},i))}),a.jsx(ae,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-2xl z-10 cursor-pointer"}),a.jsx(te,{className:"absolute right-0 top-1/2 -translate-y-1/2 text-2xl z-10 cursor-pointer"})]})}),a.jsxs("div",{className:"flex-1 p-5 ml-5 flex flex-col justify-items-center",children:[a.jsx("p",{children:"즉시 구매가"}),a.jsxs("h2",{className:"text-2xl font-bold mb-10",children:[e==null?void 0:e.productPrice,"원"]}),a.jsx("h1",{className:"text-lg font-bold",children:e==null?void 0:e.productName}),a.jsx("p",{className:"mb-10",children:e==null?void 0:e.productDescription}),!(e!=null&&e.isSell)&&a.jsxs(a.Fragment,{children:[a.jsxs(Oe,{open:$,onOpenChange:c,children:[a.jsx("button",{type:"button",onClick:y,className:"text-base font-medium py-2 px-4 border border-gray text-gray-800 rounded hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50",children:"주문하기"}),a.jsxs(M,{children:[a.jsx(F,{className:"mb-5",children:a.jsx(k,{children:"주문 정보"})}),a.jsx(N,{type:"NAME",name:"name",placeholder:"NAME",className:"w-full h-12 mb-4",onChange:g}),a.jsx(N,{type:"TEL",name:"tel",placeholder:"PHONE",className:"w-full h-12 mb-4",onChange:g}),a.jsx(N,{type:"EMAIL",name:"email",placeholder:"EMAIL",className:"w-full h-12 mb-4",onChange:g}),a.jsx("div",{className:"text-center pt-5",children:f&&a.jsx("p",{className:"text-red-500 pb-5 font-bold",children:f})}),a.jsxs(L,{children:[a.jsx("button",{type:"button",onClick:z,className:"text-base font-medium py-2 px-4 border border-gray text-gray-800 rounded hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50",children:"Order"}),a.jsx("button",{type:"button",onClick:h,className:"text-base font-medium py-2 px-4 border border-gray-300 text-gray-800 rounded hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50",children:"Cancel"})]})]})]}),a.jsx("button",{type:"button",className:"text-base font-medium py-2 px-4 border border-gray text-gray-800 rounded hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50 mt-3",children:"장바구니"})]})]})]})};export{Ge as default};
