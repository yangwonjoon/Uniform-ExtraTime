import{e as A,h as z,r as c,u as M,j as s,F as p,R as T,i as U,k as N,l as b,c as P,q as F,w as q,g as R,d as n}from"./index-0d2ZcZCT.js";import{f as G}from"./index-CUds_l8L.js";import{C as g,c as v,d as w,e as I,f as y,g as C,h as S}from"./card-LvmN36X9.js";import"./utils-CHtjtCvc.js";const V=()=>{const{user:a}=A(),{cart:m,addCart:B,removeCart:E}=z(),[u,O]=c.useState([]),[o,D]=c.useState([]),[Q,$]=c.useState([]),x=M(),k=(e,r)=>{if(r.stopPropagation(),!e){alert("제품 정보가 올바르지 않습니다.");return}a.email&&!a.isSeller?m.includes(e)?E(e):B(e):alert("구매자 아이디로 로그인해주세요!")};return c.useEffect(()=>{(async()=>{if(!a.uid)return;const r=await Promise.all(m.map(async d=>{const h=N(n,"products",d),l=await b(h);return l.exists()&&!l.data().isSell?{...l.data(),productId:l.id}:null}));O(r.filter(Boolean))})()},[m,a.uid]),c.useEffect(()=>{(async()=>{if(!a.uid)return;const r=P(n,"orders"),d=F(r,q("buyerId","==",a.email)),l=(await R(d)).docs.map(t=>t.data().productId),f=await Promise.all(l.map(async t=>{const j=N(n,"products",t),i=await b(j);return i.exists()?{...i.data(),productId:t}:null}));D(f.filter(Boolean))})()},[a.uid,a.email]),c.useEffect(()=>{(async()=>{if(!a.uid)return;const r=P(n,"orders"),d=F(r,q("sellerId","==",a.email)),l=(await R(d)).docs.map(t=>t.data().productId),f=await Promise.all(l.map(async t=>{const j=N(n,"products",t),i=await b(j);return i.exists()?{...i.data(),productId:t}:null}));$(f.filter(Boolean))})()},[a.uid,a.email]),s.jsxs("div",{children:[s.jsxs("div",{className:"w-full h-32 my-5 mt-10 flex flex-start items-center",children:[s.jsx(p,{icon:T,size:"3x",className:"basis-1/5"}),s.jsxs("div",{className:"basis-4/5 font-bold",children:[s.jsx("h1",{className:"mb-4",children:a.isSeller?s.jsx("div",{children:"Seller"}):s.jsx("div",{children:"Buyer"})}),s.jsxs("h1",{children:["Name: ",a.name]}),s.jsxs("h1",{children:["Nickname: ",a.nickname]})]})]}),a.isSeller?s.jsxs("div",{className:"w-full p-3",children:[s.jsx("h1",{className:"text-lg font-bold mb-5",children:"판매 내역"}),s.jsxs(g,{opts:{align:"start"},className:"w-full",children:[s.jsx(v,{children:Q.map(e=>s.jsx(w,{className:"md:basis-1/2 lg:basis-1/3",children:s.jsx("div",{className:"p-1",children:s.jsx(I,{children:s.jsx(y,{className:"flex aspect-square items-center justify-center p-6 relative",children:s.jsxs("div",{className:"mx-auto mb-3 w-48 h-72 overflow-hidden",onClick:()=>x(`/${e.productId}`),children:[s.jsx("div",{className:"flex items-center justify-center h-48 shadow-lg rounded-lg border border-black relative",children:s.jsx("img",{src:e.productImages[0],alt:"메인 이미지",className:"object-contain h-full"})}),s.jsxs("div",{className:"flex flex-col p-3",children:[s.jsx("h1",{className:"text-sm font-bold mb-1",children:e.productName}),s.jsxs("p",{className:"text-sm font-semibold",children:[e.productPrice,"원"]})]})]})})})})},e.productId))}),o.length>3&&s.jsx(C,{}),o.length>3&&s.jsx(S,{})]})]}):s.jsxs("div",{className:"w-full p-3",children:[s.jsx("h1",{className:"text-lg font-bold mb-5",children:"구매 내역"}),s.jsxs(g,{opts:{align:"start"},className:"w-full",children:[s.jsx(v,{children:o.map(e=>s.jsx(w,{className:"md:basis-1/2 lg:basis-1/3",children:s.jsx("div",{className:"p-1",children:s.jsx(I,{children:s.jsx(y,{className:"flex aspect-square items-center justify-center p-6 relative",children:s.jsxs("div",{className:"mx-auto mb-3 w-48 h-72 overflow-hidden",onClick:()=>x(`/${e.productId}`),children:[s.jsx("div",{className:"flex items-center justify-center h-48 shadow-lg rounded-lg border border-black relative",children:s.jsx("img",{src:e.productImages[0],alt:"메인 이미지",className:"object-contain h-full"})}),s.jsxs("div",{className:"flex flex-col p-3",children:[s.jsx("h1",{className:"text-sm font-bold mb-1",children:e.productName}),s.jsxs("p",{className:"text-sm font-semibold",children:[e.productPrice,"원"]})]})]})})})})},e.productId))}),o.length>3&&s.jsx(C,{}),o.length>3&&s.jsx(S,{})]})]}),!a.isSeller&&s.jsxs("div",{className:"w-full p-3",children:[s.jsx("h1",{className:"text-lg font-bold mb-5",children:"관심 상품"}),s.jsxs(g,{opts:{align:"start"},className:"w-full",children:[s.jsx(v,{children:u.map(e=>s.jsx(w,{className:"md:basis-1/2 lg:basis-1/3",children:s.jsx("div",{className:"p-1",children:s.jsx(I,{children:s.jsx(y,{className:"flex aspect-square items-center justify-center p-6 relative",children:s.jsxs("div",{className:"mx-auto mb-3 w-48 h-72 overflow-hidden",onClick:()=>x(`/${e.productId}`),children:[s.jsxs("div",{className:"flex items-center justify-center h-48 shadow-lg rounded-lg border border-black relative",children:[s.jsx("img",{src:e.productImages[0],alt:"메인 이미지",className:"object-contain h-full"}),e.productId&&m.includes(e.productId)?s.jsx(p,{icon:U,className:"absolute bottom-0 right-0 m-2",onClick:r=>k(e.productId,r)}):s.jsx(p,{icon:G,className:"absolute bottom-0 right-0 m-2",onClick:r=>k(e.productId,r)})]}),s.jsxs("div",{className:"flex flex-col p-3",children:[s.jsx("h1",{className:"text-sm font-bold mb-1",children:e.productName}),s.jsxs("p",{className:"text-sm font-semibold",children:[e.productPrice,"원"]})]})]})})})})},e.productId))}),u.length>3&&s.jsx(C,{}),u.length>3&&s.jsx(S,{})]})]})]})};export{V as default};
